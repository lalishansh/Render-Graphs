CMAKE_MINIMUM_REQUIRED(VERSION 3.21)

include(./~scripts/functions.cmake)
FIND_VCPKG()

# Enable testing for the project
enable_testing()
if(POLICY CMP0160)
    cmake_policy(SET CMP0160 OLD)
endif()

# Project information
PROJECT(ANARI_Experiments VERSION ${VCPKG_MANIFEST_VERSION_STRING} LANGUAGES CXX)

# Generate version.h file
SET(GENERATED_SOURCE_FILES_DIR "${CMAKE_CURRENT_BINARY_DIR}/generated")
FILE(MAKE_DIRECTORY ${GENERATED_SOURCE_FILES_DIR})
FILE(WRITE "${GENERATED_SOURCE_FILES_DIR}/version.h"
        "#pragma once\n"
        "// This file is generated by CMake\n"
        "// Do not edit this file\n\n"
        "#define ${PROJECT_NAME}_VERSION_MAJOR   ${${PROJECT_NAME}_VERSION_MAJOR}\n"
        "#define ${PROJECT_NAME}_VERSION_MINOR   ${${PROJECT_NAME}_VERSION_MINOR}\n"
        "#define ${PROJECT_NAME}_VERSION_PATCH   ${${PROJECT_NAME}_VERSION_PATCH}\n"
        "#define ${PROJECT_NAME}_VERSION_STRING \"${${PROJECT_NAME}_VERSION}\"\n"
    )

SET(CMAKE_CXX_STANDARD 20)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)

# Projects
ADD_SUBDIRECTORY(LIB_RenderGraph)
MESSAGE(${REAL_LIB_TARGET})
ADD_SUBDIRECTORY(SAMPLES)

# Packaging information
SET(CPACK_PACKAGE_VENDOR "Ishansh Lal")
SET(CPACK_PACKAGE_CONTACT "${CPACK_PACKAGE_VENDOR} <lalishansh@gmail.com>")
SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "HelloWorld, A CMake project template")

#CREATE_PACKAGES_VIA_CPACK()

# Run ~vendor/include/suppress_warnings/warning-db-rebuild.ps1
# to rebuild the warning database
# (this is a warning suppression library)
MESSAGE (STATUS "RUNNING POST CONFIG SCRIPTS")
EXECUTE_PROCESS(
    COMMAND pwsh -File "${CMAKE_SOURCE_DIR}/~vendor/include/suppress-warnings/warning-db-rebuild.ps1"
    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/~vendor/include/suppress_warnings
    OUTPUT_VARIABLE OUTPUT ECHO_OUTPUT_VARIABLE
)
MESSAGE (STATUS "OUTPUT: ${OUTPUT}")